# Authoring and build guide

This document captures the full static authoring workflow for the Normal Rooms site. Every content idiom (wiki, blog, lab notebook, and project hubs) is written once in `src/content`, rendered through shared templates in `src/templates`, and compiled into the HTML files that GitHub Pages serves.

## System overview

- **Content sources** live under `src/content/`. Markdown files contain YAML front matter that describes titles, dates, tags, and cross-links. The homepage hero uses `src/content/pages/home.yaml` for structured copy.
- **Templates** in `src/templates/` use Nunjucks to keep the header, footer, cards, tag lists, and detail layouts consistent across idioms.
- **Build script** (`npm run build`) reads the content, renders the templates, and regenerates `data/search-index.json`. The command writes the finished HTML into the repository root so GitHub Pages can serve it directly.
- **Automation** keeps navigation, tag groupings, and the search payload in sync. You never edit `blog.html`, `lab.html`, `tags.html`, or `data/search-index.json` by hand.

## Daily workflow

1. Install dependencies if you have not already: `npm install`.
2. Edit or add content in `src/content/` (use the scaffolding helpers below for blog posts and lab entries).
3. Run `npm run build` to emit updated HTML and JSON artifacts.
4. Open the generated pages locally for a spot check and run `npm test` before publishing.

## Scaffolding helpers

Two helper scripts create correctly structured stubs so you do not need to memorize front-matter fields:

```bash
# Blog post stub (fills slug + date)
npm run new:blog -- "Your Post Title"

# Lab notebook stub (requires the lab ID)
npm run new:lab -- --id NR-LAB-007 "Experiment Title"
```

The scripts populate standard TODO values for descriptions, summaries, tags, and lab fields. Replace those placeholders, add the Markdown body, and rebuild.

## Creating new content

### Blog posts (`src/content/blog`)

1. Run the scaffold command above or duplicate an existing Markdown file.
2. Update the front matter:
   - `title`: Post title (appears on the card and detail page).
   - `slug`: URL slug; the build uses it for `blog/<slug>.html`.
   - `date`: ISO date string (`YYYY-MM-DD`).
   - `category`: Meta label (e.g. Update, Release, Announcement).
   - `description`: One-line description for the search index.
   - `summary`: Excerpt shown on `blog.html`.
   - `tags`: Comma-separated topics (`workflow`, `search`, etc.).
   - `related`: Optional objects pointing at lab, project, or wiki entries. Use `type` (`lab`, `blog`, `project`, `wiki`) and `slug` (the target slug or section ID).
3. Write the Markdown body under the front matter. Build converts it to HTML.
4. Run `npm run build`. The post automatically appears in `blog.html`, `tags.html`, the homepage highlights, and the search index.

### Lab notebook entries (`src/content/lab`)

1. Scaffold with `npm run new:lab -- --id NR-LAB-### "Title"` or copy an existing file.
2. Update the front matter:
   - `id`: Stable lab identifier (`NR-LAB-007`).
   - `slug`: URL slug for `lab/<slug>.html` (auto-generated by the helper).
   - `title`: Experiment title.
   - `logged`: ISO date string for the log entry.
   - `status`: Current status (Completed, In progress, Planned, etc.).
   - `description`: One-line description for search.
   - `tags`: Topics (no need to include `lab`; the build adds it automatically).
   - `related`: Optional cross-links to blog posts, projects, or wiki sections.
   - `fields`: Fill in the `aim`, `method`, `observations`, `result`, and `next` values.
   - `summary`: Short blurb shown in listing contexts.
3. Leave the body blank unless you want extra notes—everything renders from the structured fields.
4. Rebuild to update `lab.html`, the lab detail page, tags, homepage highlights, and the search index.

### Wiki sections (`src/content/wiki`)

1. Add a Markdown file named after the section ID (for example `publishing.md`).
2. Provide front matter fields:
   - `id`: Anchor ID used in `wiki.html#<id>` and for TOC links.
   - `title`: Section heading.
   - `summary`: One-line description for the search index.
   - `order`: Sidebar ordering (ascending).
   - `tags`: Topics associated with the section.
3. Write the Markdown body below the front matter. Multiple paragraphs are fine.
4. Rebuild. The sidebar, section content, tag chips, and search entry update automatically.

### Projects (`src/content/projects`)

1. Create a Markdown file with front matter only (no body is required).
2. Required fields:
   - `id`: HTML anchor used in `projects.html#<id>`.
   - `slug`: Friendly identifier for cross-references (used by related links).
   - `title`: Project name.
   - `summary`: Description shown on the project card and in the search index.
   - `tags`: Topic tags.
   - `links`: Grouped arrays for `wiki`, `blog`, and `lab`. Each entry should include an `id` or `slug` and a `title` so the build can render proper links.
3. Rebuild. The project card, tag groupings, and search index update together.

### Static pages (`src/content/pages`)

- Markdown files (`about.md`, `contact.md`, `donate.md`) share the `page` template. Set `eyebrow`, `heading`, `description`, and `nav` in front matter, then write Markdown body copy.
- `legal.md` demonstrates using the optional `sections` array to render multiple subsections with their own headings.
- `home.yaml` controls the hero copy and intro section. Counts, recent highlights, and idiom cards populate automatically during the build, so you do not edit them manually.

## Templates and partials

- `src/templates/layouts/base.njk` defines the shared HTML shell and injects the header, footer, and script includes.
- `src/templates/partials/header.njk` and `footer.njk` accept `page.basePath` and `page.nav` so nested pages (blog posts, lab entries) resolve assets correctly and highlight the current section.
- Each idiom has a dedicated template under `src/templates/pages/` to render listings and detail views.
- If you tweak markup or introduce a new component, update the relevant template once; every rendered page will inherit the change on the next build.

## Automation details

- `npm run build` always regenerates `data/search-index.json` from the front matter so the client-side search stays fresh.
- Tag groups in `tags.html` are derived from the tags you assign. Structural tags (`wiki`, `blog`, `project`) are hidden from the public tag cloud, but remain in the search payload for filtering.
- Homepage stats count wiki sections, project hubs, and lab entries dynamically.
- Blog archives group posts by month-year and update as soon as new posts appear.

## Quality checks

- Run `npm test` after rebuilding to ensure navigation, search, and link integrity remain intact.
- Spot-check affected pages in a browser (especially when editing templates) to confirm spacing and semantics.

## Conventions and best practices

- Slugs should be lowercase with hyphens (`lab/search-prototype-benchmark`).
- Keep tag names short, lowercase, and single words for clean anchors.
- When adding new tags, no manual updates are required—just use the tag in front matter and rebuild.
- Cross-link with the `related` arrays so templates can surface backlinks on blog posts and lab entries.
- Commit both the source changes (`src/…`) and the generated artifacts (`*.html`, `data/search-index.json`) together so GitHub Pages always serves the latest build.
